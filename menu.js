const db = {
  "bbqs": [
    {
      "id": "ribs-brisket-and-burnt-ends",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/79619/joes-kc-ribs-brisket-and-burnt-ends.6710e994980e485e6441b794717ad6fb.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Joe's KC BBQ",
      "dsc": "Joe's KC Ribs, Brisket & Burnt Ends",
      "price": 110.99,
      "rate": 4,
      "country": "Kansas City, KS"
    },
    {
      "id": "005-kings-carolina-oink-sampler",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/66752/carolina-bbq-oink-sampler.1340b5a10cedc238cb2280306dd1d5a5.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Kings BBQ",
      "dsc": "Carolina BBQ Oink Sampler",
      "price": 89,
      "rate": 4,
      "country": "Kinston, NC"
    },
    {
      "id": "texas-monthlys-1-bbq-brisket",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/131249/texas-monthlys-1-bbq-brisket.1006a061be7acae03992e420fbca995a.png?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Snow's BBQ",
      "dsc": "Texas Monthly's #1 BBQ Brisket",
      "price": 199,
      "rate": 4,
      "country": "Lexington, TX"
    },
    {
      "id": "17352-ribs-and-pulled-pork-small-combo-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/137366/Central-BBQ-Ribs-Pulled-Pork-Dinner-1.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Central BBQ",
      "dsc": "Ribs & Pulled Pork Dinner for 4",
      "price": 79,
      "rate": 4,
      "country": "Memphis, TN"
    },
    {
      "id": "whole-brisket-texas-bbq-sauce",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/110384/whole-brisket-texas-barbecue-bbq-sauce.e07ee4818b20ed43d217bf67fedd41ce.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Franklin Barbecue",
      "dsc": "Whole Brisket + Texas Barbecue BBQ Sauce",
      "price": 249,
      "rate": 4,
      "country": "Austin, TX"
    }
  ],
"burgers": [
    {
      "id": "the-gramercy-tavern-burger-4-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/137148/Gramercy-Tavern-Burger-and-Kielbasa-Kit-6.4.21-72ppi-1x1-15.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Gramercy Tavern",
      "dsc": "The Gramercy Tavern Burger - 4 Pack",
      "price": 99,
      "rate": 5,
      "country": "New York, NY"
    },
    {
      "id": "shake-shack-shackburger-8-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/134862/shake-shack-shackburger-8-pack.973a5e26836ea86d7e86a327becea2b0.png?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Shake Shack",
      "dsc": "Shake Shack ShackBurger® – 8 Pack",
      "price": 49,
      "rate": 5,
      "country": "New York, NY"
    },
    {
      "id": "gotts-cheeseburger-kit-for-4",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/132933/gotts-complete-cheeseburger-kit-for-4.7bdc74104b193427b3fe6eae39e05b5e.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Gott's Roadside",
      "dsc": "Gott's Complete Cheeseburger Kit for 4",
      "price": 99,
      "rate": 5,
      "country": "St. Helena, CA"
    },
    {
      "id": "wagyu-burger-patties-12-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/107019/wagyu-burger-patties-12-pack.6116f4cd648dee20651f99e21e7d758b.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Westholme Wagyu",
      "dsc": "Wagyu Burger Patties - 12 Pack",
      "price": 129,
      "rate": 5,
      "country": "Queensland, Australia"
   },
    {
      "id": "shake-shack-shackburger-16-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/134022/shake-shack-shackburger-16-pack.316f8b09144db65931ea29e34869287a.png?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Shake Shack",
      "dsc": "Shake Shack Shackburger® – 16 Pack",
      "price": 89,
      "rate": 4,
      "country": "New York, NY"
    }
  ],
"desserts": [
    {
      "id": "15259-german-chocolate-killer-brownie-tin-pack",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/132029/german-chocolate-killer-brownie-tin-pack.5ebc34160f28767a9d94c4da2e04c4b9.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Killer Brownie®",
      "dsc": "German Chocolate Killer Brownie®",
      "price": 39.99,
      "rate": 4,
      "country": "Dayton, OH"
    },
    {
      "id": "best-seller-cupcake-dozen",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/94478/best-seller-cupcake-dozen.f93b21993f6a2da11c975d45b9b0d08f.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Crave Cupcakes",
      "dsc": "Best Seller Cupcake Dozen",
      "price": 89,
      "rate": 4,
      "country": "Houston, TX"
    },
    {
      "id": "jacques-world-famous-chocolate-chip-cookies",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/81172/jacques-world-famous-chocolate-chip-cookies-6-pack.2217a14c443602493bba88aa9335319a.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Jacques Torres Chocolate",
      "dsc": "Jacques’ World Famous Chocolate Chip Cookies - 6 Pack",
      "price": 39.95,
      "rate": 4,
      "country": "New York, NY"
    },
    {
      "id": "luigis-original-cannoli-pie",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/132206/original-cannoli-pie.4cb5b9ba82f57b69b90765fd9f07aa1a.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "The Cannoli Pie Company",
      "dsc": "Original Cannoli Pie",
      "price": 69,
      "rate": 4,
      "country": "Bridgeport, CT"
    },
    {
      "id": "sea-salted-caramel-swirl-cheesecake",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/134006/sea-salted-caramel-swirl-cheesecake.e2825335433fb7a272a5d77649a6849e.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Cotton Blues Cheesecake Company",
      "dsc": "Sea-Salted Caramel Swirl Cheesecake",
      "price": 65,
      "rate": 4,
      "country": "Hattiesburg, MS"
    }
  ],
"drinks": [
    {
      "id": "hong-kong-boba-tea-kit-for-6",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/108725/hong-kong-boba-tea-kit-for-6.63841de36d8e5edfafa13023fc303285.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "New Territories",
      "dsc": "Hong Kong Boba Tea Kit for 6",
      "price": 59,
      "rate": 4,
      "country": "New York, NY"
    },
    {
      "id": "guys-caliente-margaritas-for-12",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/126836/guys-caliente-margaritas-for-12.ca8c6bc06b8f1039549385ffcebc749d.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Guy Fieri",
      "dsc": "Guy's Caliente Margaritas for 12",
      "price": 69,
      "rate": 5,
      "country": "Flavortown, USA"
    },
    {
      "id": "woodford-reserve-mint-julep-syrup",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/134036/woodford-reserve-mint-julep-syrup.ef523ac7cbae5f4aba6b058207f490d2.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Woodford Reserve",
      "dsc": "Woodford Reserve Mint Julep Syrup",
      "price": 39,
      "rate": 4,
      "country": "Louisville, KY"
    },
    {
      "id": "new-orleans-hurricane-mix",
      "img": "https://goldbelly.imgix.net/uploads/showcase_media_asset/image/84522/new-orleans-hurricane-mix.4613584fc65cb0787024dd24d2a8f4b3.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Franco's Hurricane Mix",
      "dsc": "New Orleans Hurricane Mix",
      "price": 39,
      "rate": 5,
      "country": "Natchitoches, LA"
    },
    {
      "id": "evan-williams-gourmet-mint-julep-mix-2-pack",
      "img": "https://goldbelly.imgix.net/uploads/product_image/image/42820/evan-williams-gourmet-mint-julep-mix-2-pack.a0bd561099dd14bfb33e3363c1c025d0.jpg?ixlib=react-9.0.2&auto=format&ar=1%3A1",
      "name": "Evan Williams",
      "dsc": "Evan Williams Gourmet Mint Julep Mix - 2 Pack",
      "price": 39,
      "rate": 4,
      "country": "Louisville, KY"
    }
  ],
"pagination": {
    "bbqs": 5,
    "burgers": 5,
    "desserts": 5,
    "drinks": 5

// Daniels featured food and drink section.

}
}

// Initialisera varukorgen som en tom array
let varukorg = JSON.parse(sessionStorage.getItem('varukorg')) || [];

// ======================= Varukorgsfunktioner =======================

// Funktion för att lägga till produkter i varukorgen
function addToCart(produkt) {
console.log('Lägger till i varukorgen:', produkt); // Logga vilken produkt som läggs till
varukorg.push(produkt);
sessionStorage.setItem('varukorg', JSON.stringify(varukorg));
showMiniPopup(produkt);
updateCart();
}

// Funktion för att visa en mobilvänlig mini-popup
function showMiniPopup(produkt) {
let popup = document.querySelector('.mini-popup');

if (!popup) {
  popup = document.createElement('div');
  popup.className = 'mini-popup';
  popup.style.display = 'none';
  popup.innerHTML = `
    <div class="mini-popup-content">
      <p> Till Din Varukorgen!</p>
      <p>Totalt: <span id="mini-popup-total">${calculateTotal()} kr</span></p>
      <button onclick="goToCheckout()">Till Kassan</button>
    </div>
  `;
  document.body.appendChild(popup);
}

document.getElementById('mini-popup-total').textContent = `${calculateTotal()} kr`;
popup.style.display = 'block';
}

// Funktion för att räkna ut totalpris
function calculateTotal() {
return varukorg.reduce((sum, item) => sum + item.price, 0).toFixed(2);
}

// Funktion för att uppdatera varukorgens visning
function updateCart() {
const totalDisplay = document.getElementById('total'); // Totalpris
const cartItems = document.getElementById('cart-items'); // Lista med produkter

if (!totalDisplay || !cartItems) {
  console.error('Varukorgselement saknas i DOM.');
  return; // Säkerställ att element finns
}

// Töm tidigare innehåll
cartItems.innerHTML = '';

// Kontrollera om varukorgen är tom
if (varukorg.length === 0) {
  totalDisplay.textContent = '0';
  console.log('Varukorgen är tom.');
  document.querySelector('.mini-popup').style.display = 'none'; // Dölj popupen
  return;
}

let total = 0;

// Loopa igenom varukorgen och uppdatera visningen
varukorg.forEach((vara, index) => {
  total += vara.price; // Beräkna totalpris

  // Skapa listobjekt
  const li = document.createElement('li');
  li.textContent = `${vara.name} - ${vara.price} kr`;

  // Skapa "Ta bort"-knapp för varje produkt
  const removeButton = document.createElement('button');
  removeButton.textContent = 'Ta bort';
  removeButton.onclick = () => removeFromCart(index);
  li.appendChild(removeButton);

  cartItems.appendChild(li);
});

// Uppdatera totalpris
totalDisplay.textContent = total.toFixed(2);
console.log('Varukorgen uppdaterad:', varukorg);
}

// Funktion för att ta bort en produkt från varukorgen
function removeFromCart(index) {
console.log('Tar bort produkt från varukorgen:', varukorg[index]);
varukorg.splice(index, 1); // Ta bort produkten från varukorgen
sessionStorage.setItem('varukorg', JSON.stringify(varukorg)); // Uppdatera sessionStorage
updateCart(); // Uppdatera visningen
}

// Funktion för att visa kassasidan som en popup
function showCheckout() {
const checkoutSection = document.getElementById('checkout');
const cartSection = document.getElementById('cart');

if (checkoutSection && cartSection) {
  cartSection.style.display = 'none';
  checkoutSection.style.display = 'block';
  console.log('Kassasidan är nu synlig.');
  renderCheckout();
} else {
  console.error('Kassasidan eller varukorgen kunde inte hittas i DOM.');
}
}

function goToCheckout() {
console.log('Navigerar till kassasidan.');
window.location.href = 'kassa.html'; // Navigera till kassasidan
}


// ======================= Kassasidan =======================

function goBackToCart() {
window.location.href = 'index.html'; // Byt till rätt sökväg för din startsida
}

// Funktion för att tilldela ett slumpmässigt bord
function assignRandomTable() {
const tableNumber = Math.floor(Math.random() * 20) + 1; // Slumpmässigt bord mellan 1 och 20
const tableElement = document.getElementById('table-number');
if (tableElement) {
  tableElement.textContent = `Bord: ${tableNumber}`;
} else {
  console.log(`Tilldelat bord: ${tableNumber}`);
}
}


// Funktion för att rendera varukorgen på kassasidan
function renderCheckout() {
const checkoutItems = document.getElementById('checkout-items');
const checkoutTotal = document.getElementById('checkout-total');

if (!checkoutItems || !checkoutTotal) {
  console.error('Element för kassasidan saknas i DOM.');
  return;
}

// Hämta varukorgen från sessionStorage
let savedCart = JSON.parse(sessionStorage.getItem('varukorg')) || [];
let total = 0;

// Töm tidigare innehåll
checkoutItems.innerHTML = '';

// Loopa igenom varukorgen och rendera produkter
savedCart.forEach((vara, index) => {
  total += vara.price;

  const li = document.createElement('li');
  li.textContent = `${vara.name} - ${vara.price} kr`;

  const removeButton = document.createElement('button');
  removeButton.textContent = 'Ta bort';
  removeButton.onclick = () => removeFromCheckout(index);
  li.appendChild(removeButton);

  checkoutItems.appendChild(li);
});

// Uppdatera totalpris
checkoutTotal.textContent = total.toFixed(2);
console.log('Kassasidan uppdaterad:', savedCart);
}

// Funktion för att ta bort en produkt från varukorgen på kassasidan
function removeFromCheckout(index) {
let savedCart = JSON.parse(sessionStorage.getItem('varukorg')) || [];
console.log('Tar bort produkt från kassasidan:', savedCart[index]);
savedCart.splice(index, 1);
sessionStorage.setItem('varukorg', JSON.stringify(savedCart));
renderCheckout();
}

// ======================= Sidinitiering =======================

window.onload = () => {
if (window.location.href.includes('kassa.html')) {
  console.log('Laddar kassasidan.');
  renderCheckout();
  assignRandomTable(); // Tilldela ett bord
} else {
  console.log('Laddar förstasidan.');
  updateCart();




  // Lägg till knapp för att visa kassan
  const showCartButton = document.createElement('button');
  showCartButton.textContent = 'Visa Kassan';
  showCartButton.onclick = goToCheckout;
  showCartButton.style.display = 'none'; // Dölj knappen som standard
  document.body.appendChild(showCartButton);
}
};

// ======================= Navigering till betygssidan =======================
// Hanterar knappen "Slutför ditt köp" och navigerar till betygssidan
const finishPurchaseButton = document.getElementById('finish-purchase-button');

if (finishPurchaseButton) {
  finishPurchaseButton.addEventListener('click', () => {
    window.location.href = 'Betygssida.html'; // Navigera till betygssidan
  });
}

// Get all radio inputs and their corresponding stars
const ratingInputs = document.querySelectorAll('input[name="rating"]');
const stars = document.querySelectorAll('.rating-star');

// Add an event listener to each input
ratingInputs.forEach((input, index) => {
  input.addEventListener('change', () => {
    // Reset all stars to their default size
    stars.forEach(star => star.classList.remove('selected'));

    // Highlight the selected star
    stars[index].classList.add('selected');
  });
});




const mainDishes = [...db.bbqs, ...db.burgers];
const drinkItems = db.drinks;

function getRandomItem(array) {
  return array[Math.floor(Math.random() * array.length)];
}
// Will grab a random item from the specified food lists and the specified drinks list.
function displayFeaturedItems() {
  const featuredFood = getRandomItem(mainDishes);
  const featuredDrink = getRandomItem(drinkItems);
// Grabs a food item from bbqs list or burgers list and shows the image and name.
  document.getElementById('featured-food').innerHTML = `
      <img src="${featuredFood.img}" alt="${featuredFood.name}">
      <h3>${featuredFood.name}</h3>
  `;
// Grabs a drink item from the drinks list and shows the image and name.
  document.getElementById('featured-drink').innerHTML = `
      <img src="${featuredDrink.img}" alt="${featuredDrink.name}">
      <h3>${featuredDrink.name}</h3>
  `;
}

displayFeaturedItems();

//Skapar en div som kommer innehålla innehåll för varje maträtt/dryck/efterrätt
function createProductCard(product) { 

const productDiv = document.createElement('div');
//Ger productDiv class namn product för styling
productDiv.className = 'product'; 
//Skapar ett img element
const img = document.createElement('img');
//Src till bilden 
img.src = product.img; img.alt = product.name;
//Som läggs till i productDiv
productDiv.appendChild(img); 

//Skapar en h2 som kommer innehålla namnet på rätten
const name = document.createElement('h2'); 
name.textContent = product.name;
productDiv.appendChild(name); 

//Skapar en p som kommer innehålla beskrivning
const description = document.createElement('p'); 
description.textContent = product.dsc; 
productDiv.appendChild(description);

//Skapar en div för pris
const price = document.createElement('div'); 
price.className = 'price';
//Priset läggs till price
price.textContent = `$${product.price.toFixed(2)}`; 
productDiv.appendChild(price); 

//Skapar en div som ska innehålla rating
const rate = document.createElement('div'); 
rate.className = 'rate'; 
//Antal stjärnor läggs till
rate.textContent = `Rating: ${'⭐'.repeat(product.rate)}`; 
productDiv.appendChild(rate);

//Skapar en p som innehåller land
const country = document.createElement('p'); 
country.textContent = product.country; 
productDiv.appendChild(country);

//Skapar en köp knapp 
const buyButton = document.createElement("button");
buyButton.textContent = "Köp";
buyButton.style.width = "5rem";
buyButton.style.padding = ".5rem";
buyButton.style.borderRadius = "25px";
buyButton.style.border = "none";
buyButton.onclick = () => addToCart(product);
productDiv.appendChild(buyButton);
//Returnerar diven med innehåll
return productDiv; 
} 

function displayProducts(categoryId, products) {
// Hämta den specifika kategori-sektionen baserat på id:t som skickas in
const categorySection = document.getElementById(categoryId);

//Loopar igenom för varje produkt
products.forEach(product => {
  //Skapar ett produktkort
  const productCard = createProductCard(product);
  //Lägger till produktkortet i categorySection
  categorySection.appendChild(productCard); }); 
} 

// Visa produkterna i respektive kategori genom att kalla på displayProducts med categoryId och products
displayProducts('bbqs', db.bbqs); 
displayProducts('burgers', db.burgers); 
displayProducts('desserts', db.desserts); 
displayProducts('drinks', db.drinks);


// Daniels search functions.
// Search food and drink.
function searchMenu() {
  const searchInput = document.getElementById('search');
  const resultsContainer = document.getElementById('search-results');

  // Event listener for what the guest is looking for. 
  searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase().trim();
      filterResults(searchTerm);
  });

  // Makes it so that the form isn't sent when pressing enter.
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault(); // Prevents a page reload.
    }
});
}

// Filter and show results.
function filterResults(searchTerm) { 
  let results = [];

// If there is no search item, clear the results.
  if (!searchTerm) {
    document.getElementById('search-results').innerHTML = '';
    return;
}
// Allows different search terms to work and get results.
  const categoryMap = {
        'bur': 'burgers',
        'burg': 'burgers',
        'burge': 'burgers',
        'burger': 'burgers',
        'burgers': 'burgers',
        'bbq': 'bbqs',
        'bbqs': 'bbqs',
        'des': 'desserts',
        'dess': 'desserts',
        'desse': 'desserts',
        'desser': 'desserts',
        'dessert': 'desserts',
        'desserts': 'desserts',
        'dri': 'drinks',
        'drin': 'drinks',
        'drink': 'drinks',
        'drinks': 'drinks'
};
// Checks if search matches a category.
if (categoryMap[searchTerm]) {
  results = db[categoryMap[searchTerm]];
} else {
      // Filter through the categories and ignore pagination.
      for (const category in db) {
        if (category !== 'pagination' && Array.isArray(db[category])) {
          const matches = db[category].filter(item =>
              item.name.toLowerCase().includes(searchTerm)
          );
          results = [...results, ...matches];
      }  
  }
}
// Shows the results here.
displayResults(results);
}
// This will show the results with name and picture of the menu item.
function displayResults(results) {
  const resultsContainer = document.getElementById('search-results');

  // If nothing is found in the search.
  if (!results || results.length === 0) {
    resultsContainer.innerHTML = '<p>Inga resultat hittades.</p>';
    return;
}

  // Shows the results.
  resultsContainer.innerHTML = results.map(item => `
      <article style="background: linear-gradient(135deg, #ff6b6b 0%, #ffffff 50%, #4a90e2 100%);">
          <h3>${item.name}</h3>
          <img src="${item.img}" alt="${item.name}" loading="lazy">
      </article>
  `).join('');
}

// Loads the function to be able to search.
document.addEventListener('DOMContentLoaded', searchMenu);


